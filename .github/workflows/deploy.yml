name: 🚀 Deploy to Devserver

on:
  workflow_dispatch:  # Allows manual trigger from GitHub UI

jobs:
  deploy:
    name: Fabric Deployment
    runs-on: ubuntu-latest

    env:
      HOST: "192.168.50.12"
      USER: "aabid"

    steps:
      - name: 🛒 Checkout repository
        uses: actions/checkout@v3

      - name: 🐍 Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: ⚙️ Install Fabric and dependencies
        run: |
          pip install fabric

      - name: 🔐 Setup SSH
        run: |
          mkdir -p ~/.ssh
          echo "${{ secrets.DEV_SSH_KEY }}" > ~/.ssh/id_rsa
          chmod 600 ~/.ssh/id_rsa
          ssh-keyscan -H $HOST >> ~/.ssh/known_hosts

      - name: 📁 Create placeholder for remote host config (optional)
        run: |
          echo "Host $HOST\n  User $USER\n  IdentityFile ~/.ssh/id_rsa\n  StrictHostKeyChecking no" >> ~/.ssh/config
          chmod 600 ~/.ssh/config

      - name: 🚀 Run deployment with Fabric
        run: fab -H $USER@$HOST deploy_cicd
      #on: workflow_dispatch:

